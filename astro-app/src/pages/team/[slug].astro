---
import type { InferGetStaticParamsType } from "astro";
import Layout from '../../layouts/Layout.astro';
import { sanityClient } from "sanity:client";
import groq from "groq";
import { urlFor } from '../../utils/image';

export async function getStaticPaths() {
  const members = await sanityClient.fetch(
    groq`*[_type == "member"]{
      slug
    }`
  );
  
  return members.map((member: any) => ({
    params: { slug: member.slug.current },
  }));
}

type Params = InferGetStaticParamsType<typeof getStaticPaths>;
const { slug } = Astro.params as Params;

const member = await sanityClient.fetch(
  groq`*[_type == "member" && slug.current == $slug][0]{
    _id,
    name,
    slug,
    position,
    background,
    focus,
    mainImage,
    investmentCompanies[]->{
      _id,
      name,
      slug,
      logo
    }
  }`,
  { slug }
);
---

<Layout title={member.name} pageSlug="member">
  <section class="member-page regular-grid">
    <div class="member-header">
      {member.mainImage && (
        <div class="member-image">
          <img 
            src={urlFor(member.mainImage).width(800).height(800).url()} 
            alt={member.mainImage.alt || member.name}
          />
        </div>
      )}
      
      <div class="member-details">
        <h1>{member.name}</h1>
        {member.position && (
          <p class="position sans uppercase">{member.position}</p>
        )}
      </div>
    </div>

    {member.background && (
      <div class="member-section">
        <h2>Background</h2>
        <p>{member.background}</p>
      </div>
    )}

    {member.focus && (
      <div class="member-section">
        <h2>Focus</h2>
        <p>{member.focus}</p>
      </div>
    )}

    {member.investmentCompanies && member.investmentCompanies.length > 0 && (
      <div class="member-section">
        <h2>Investment Companies</h2>
        <div class="companies-grid">
          {member.investmentCompanies.map((company: any) => (
            <a href={`/portfolio/${company.slug.current}`} class="company-card">
              {company.logo && (
                <img 
                  src={urlFor(company.logo).width(200).height(200).url()} 
                  alt={company.logo.alt || company.name}
                />
              )}
              <h3>{company.name}</h3>
            </a>
          ))}
        </div>
      </div>
    )}
  </section>
</Layout>

<style>
  .member-page {
    padding: 100px var(--gap) 200px;
  }

  .member-header {
    grid-column: span 12;
    display: grid;
    grid-template-columns: repeat(12, 1fr);
    gap: var(--gap);
    margin-bottom: 80px;
  }

  .member-image {
    grid-column: span 6;
  }

  .member-image img {
    width: 100%;
    height: auto;
  }

  .member-details {
    grid-column: span 6;
    display: flex;
    flex-direction: column;
    justify-content: center;
  }

  .member-details h1 {
    margin-bottom: 16px;
  }

  .position {
    font-size: 1.2rem;
    opacity: 0.7;
  }

  .member-section {
    grid-column: span 8;
    margin-bottom: 60px;
  }

  .member-section h2 {
    margin-bottom: 24px;
  }

  .member-section p {
    line-height: 1.6;
  }

  .companies-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 24px;
    margin-top: 24px;
  }

  .company-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    padding: 24px;
    border: 1px solid currentColor;
    text-decoration: none;
    transition: opacity 0.2s;
  }

  .company-card:hover {
    opacity: 0.7;
  }

  .company-card img {
    width: 100%;
    max-width: 120px;
    height: auto;
  }

  .company-card h3 {
    font-size: 1rem;
    text-align: center;
  }
</style>
