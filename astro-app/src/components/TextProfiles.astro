---
import { urlFor } from '../utils/image';

interface Profile {
  _key: string;
  name: string;
  position: string;
  background: string;
  mainImage?: any;
  member?: {
    _id: string;
    name: string;
    slug: {
      current: string;
    };
  };
}

interface Props {
  profiles: Profile[];
  text?: string;
}

const { profiles, text } = Astro.props;
---

<div class="text-profiles regular-grid">  
  {profiles && profiles.length > 0 && (
    <div class="profiles-grid">
      {profiles.map((profile) => {
        const CardTag = profile.member && profile.member.slug ? 'a' : 'div';
        const cardClass = profile.member && profile.member.slug 
          ? 'profile-card back-hover' 
          : 'profile-card';
        const cardProps = profile.member && profile.member.slug 
          ? { href: `/team/${profile.member.slug.current}` }
          : {};
        
        return (
          <CardTag class={cardClass} {...cardProps}>
            {profile.mainImage && (
              <div class="profile-image">
                <img 
                  src={urlFor(profile.mainImage).width(400).height(400).url()} 
                  alt={profile.mainImage.alt || profile.name}
                />
              </div>
            )}
            <div class="profile-infos">
              <div class="profile-name-position">
                <h3>{profile.name}</h3>

                {profile.position && (
                  <span class="profile-position sans uppercase">{profile.position}</span>
                )}

                <span class="hover-arrow">â†’</span>
              </div>

              <div class="profile-background">
                {profile.background && (
                  <p class="profile-background" set:html={profile.background.replace(/\n/g, '<br>')} />
                )}
              </div>
            </div>
          </CardTag>
        );
      })}
    </div>
  )}

  {text && (
    <div class="profiles-background">
      <p set:html={text.replace(/\n/g, '<br>')} />
    </div>
  )}
</div>

<style>
  .text-profiles {
    padding: 0 var(--gap);
    margin-bottom: 128px;
  }
  
  .profiles-background {
    grid-column: 9 / span 4;
  }

  .profiles-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: var(--gap);
    grid-column: 2 / span 6;
  }

  .profile-card {
    display: flex;
    flex-direction: column;
    gap: 8px;
    text-decoration: none;
    color: inherit;
    height: fit-content;
    padding-bottom: 4px;
  }

  .profile-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .profile-infos {
    display: flex;
    flex-direction: column;
    gap: 9px;
  }

  .profile-name-position {
    display: flex;
    flex-direction: column;
    gap: 5px;
    position: relative;
  }

  @media screen and (max-width: 820px) {
    .profiles-grid,
    .text-profiles {
      grid-template-columns: 1fr;
      grid-column: span 1;
    }

    .profiles-grid {
      gap: 36px;
    }

    .text-profiles {
      gap: 72px;
      margin-bottom: 72px;
    }
    
    .profiles-background {
      grid-column: span 1;
    }

    .profile-card {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--gap);
      padding-bottom: 0;
    }

    .profile-infos {
      display: flex;
      flex-direction: column;
      gap: var(--gap);
      justify-content: space-between;
    }
  }
</style>
